<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Afiche: Relación entre Edificios y Renta Nacional</title>

    <!-- Fuente de Google -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">

    <!-- Importar el CSS externo -->
    <link rel="stylesheet" href="styles.css">

    <script src="https://cdn.plot.ly/plotly-2.34.0.min.js"></script>
    <script src="data.js"></script> <!-- Importa el archivo de datos -->
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>¿Hay una relación entre los edificios más altos del mundo y la riqueza del país de procedencia?</h1>
            <p>Un análisis comparativo de los edificios más altos en varios países y su Renta Nacional Bruta per cápita.</p>
        </div>

        <div class="section">
            <h2 class="section-title">Introducción</h2>
            <p>
                La renta nacional bruta o RNB es la suma de las retribuciones de todos los factores de producción nacionales. 
                La composición del producto interior bruto (PIB) desde el punto de vista de la renta, tiene en cuenta todas 
                aquellas partidas que son una retribución a los factores de producción, es decir: rentas del trabajo (salarios), 
                rentas de la tierra (alquileres) y rentas del capital (intereses y beneficio de las empresas).
            </p>
            <p>Por ello, se usó este indicador para el gráfico, utilizando datos de todos los países, pero descartando 
                los que tienen edificios con altura bajo el promedio, ya que no son de gran utilidad para esta evaluación.</p>
        </div>

        <div class="section chart">
            <h2 class="section-title">Gráfico de Barras</h2>
            <div id="chart-container" style="position: relative;">
                <div id="bar-chart"></div> <!-- Gráfico -->
                <div id="custom-legend" class="legend-inside"></div> <!-- Leyenda dentro del gráfico -->
            </div>
        </div>

    </div>

    <script>
        // Código Plotly para el gráfico de barras
        let datosOrdenados = datos.slice();
        datosOrdenados.sort((a, b) => a["GNI per capita"] - b["GNI per capita"]);

        // Define los países destacados
        const paisesDestacados = ["China", "Malaysia", "United Arab Emirates", "Ethiopia", "Uruguay", "Qatar"];

        const countries = datosOrdenados.map(dato => dato.Country);
        const heights = datosOrdenados.map(dato => dato.Height);
        const gniPerCapita = datosOrdenados.map(dato => dato["GNI per capita"]);

        // Colores para las barras
        const minGNI = Math.min(...gniPerCapita);
        const maxGNI = Math.max(...gniPerCapita);

        const colors = gniPerCapita.map(gni => {
            const scale = (gni - minGNI) / (maxGNI - minGNI);
            const blueValue = Math.round(255 * (1 - scale));
            const purpleValue = Math.round(255 * scale);
            return `rgba(${purpleValue}, ${blueValue}, 255, 1)`;
        });

        // Agregar el borde negro a las barras de los países destacados
        const barData = [{
            type: 'bar',
            x: countries,
            y: heights,
            marker: {
                color: colors,
                line: {
                    width: countries.map(country => paisesDestacados.includes(country) ? 3 : 0), // Borde negro si es un país destacado
                    color: 'black'
                }
            },
        }];

        const barLayout = {
            title: { 
                text: 'Altura del edificio más alto por país vs Renta Nacional Bruta per cápita',
                font: { 
                    family: 'Arial, sans-serif', 
                    size: 18, 
                    color: '#333', 
                    weight: 'bold' }
            },
            xaxis: { 
                title: 'Países',
                showticklabels: false,
            },
            yaxis: { 
                title: 'Altura (m)',
                tickfont: { size: 12 }, 
                range: [0, Math.max(...heights) * 1.1] 
            },
            paper_bgcolor: '#f0f4f8',
            plot_bgcolor: '#fff',
            margin: { t: 60, r: 30, b: 120, l: 50 },
        };

        // Leyenda personalizada existente
        const legendHTML = `
            <div class="legend-gradient">
                <div class="legend-label">$${minGNI} (Menor GNI per capita)</div>
                <div class="legend-bar"></div>
                <div class="legend-label">$${maxGNI} (Mayor GNI per capita)</div>
            </div>
        `;

        // Nueva leyenda para países destacados
        const destacadosHTML = `
            <div class="highlighted-legend">
                <b>Países destacados:</b><br>
                <b>China, Malaysia, United Arab Emirates:</b> Edificios altos, pero con gran variación en el GNI per cápita.<br>
                <b>Ethiopia, Uruguay, Qatar:</b> Edificios bajos, pero con gran variación en el GNI per cápita.
            </div>
        `;

        // Asigna las leyendas personalizadas
        const legendContainer = document.getElementById('custom-legend');
        legendContainer.innerHTML = ''; // Limpia el contenido existente

        // Crear contenedores para cada leyenda
        const gradientLegend = document.createElement('div');
        const highlightedLegend = document.createElement('div');

        // Asignar HTML a cada leyenda
        gradientLegend.innerHTML = legendHTML;
        highlightedLegend.innerHTML = destacadosHTML;

        // Agregar cada contenedor al contenedor principal
        legendContainer.appendChild(gradientLegend);
        legendContainer.appendChild(highlightedLegend);

        Plotly.newPlot('bar-chart', barData, barLayout);
    </script>
</body>
</html>
